<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:link="http://www.link.it"
	xmlns:c="http://java.sun.com/jstl/core"
	template="/templates/form.xhtml">
	<f:loadBundle var="msg" basename="messages" />
	
		<ui:param value="Gestione Utente" name="title" />
		<ui:define name="navbar">
			<ul>
				<c:if test="#{applicationBean.amministratore}">
					<li>
						<h:commandLink id="utenti" action="user" value="Utenti"/>
					</li>
					<li><h:graphicImage value="/images/tema_link/next_white.png" width="16" height="16"/></li>
				</c:if>	
				<li>
					<h:outputText styleClass="ultimo-path" id="profUtente" value="#{utentiBean.profilo}"/>
				</li>
			</ul>
		</ui:define>
		<ui:define name="body">
			<style>
				.rich-shuttle-source-items { margin-left :0px;
				}
			</style>
			<a4j:keepAlive beanName="utentiBean" />
				<c:if test="#{applicationBean.amministratore}">
						<h:form id="formRoleAdmin" prependId="false" >
							
							<link:fieldset legend="Informazioni Utente" rendered="#{true}" collapsible="false" closed="false">
								<link:prop label="Username" required="true">
									<h:inputText label="Username" id="_user" value="#{utentiBean.user.login}" readonly="#{not empty utentiBean.user.id and utentiBean.user.id gt 0}" styleClass="inputLinkLong" />
								</link:prop>
								
								<link:prop label="Password" required="true" rendered="#{applicationBean.showCambiaPassword and (empty utentiBean.user.id or (not empty utentiBean.user.id and utentiBean.user.id lt 1))}"> 
									<h:inputSecret label="Password" id="_pwd" value="#{utentiBean.user.password}" styleClass="inputLinkLong"/>
								</link:prop>
									
								<link:prop label="Conferma Password" required="true" 
									rendered="#{applicationBean.showCambiaPassword and (empty utentiBean.user.id or (not empty utentiBean.user.id and utentiBean.user.id lt 1))}"
									note="#{utentiBean.notePassword}" noteEscape="false">
									<h:inputSecret id="conpwd" label="Conferma Password" value="#{utentiBean.confermaPassword}"  styleClass="inputLinkLong"/>
								</link:prop>
								
								<link:prop label="Ruoli" required="true">
									<h:selectManyCheckbox id="selectRuoli" styleClass="controlset" value="#{utentiBean.roles}"  label="Ruoli">
										<f:selectItem id="roleAdmin" itemLabel="Amministratore" itemValue="ROLE_ADMIN"/>
										<c:if test="#{applicationBean.showRuoloConfiguratore}">
											<f:selectItem id="roleConfig" itemLabel="Configuratore" itemValue="ROLE_CONFIG"/>
										</c:if>
										<f:selectItem id="roleOp" itemLabel="Operatore" itemValue="ROLE_OPERATORE"/>
										<a4j:support event="onclick" reRender="soggettiServiziAssociatiCtr" ajaxSingle="true"/>
									</h:selectManyCheckbox>
								</link:prop>
							</link:fieldset>
								
							<a4j:outputPanel id="soggettiServiziAssociatiCtr" layout="block">
								<link:fieldset legend="Soggetti e Servizi associati" rendered="#{utentiBean.showSoggettiAssociati}" collapsible="false" closed="false">
									<link:prop label="Criteri selezione">
										<h:selectManyCheckbox id="selectCriteri" styleClass="controlset" value="#{utentiBean.criteri}"  label="Criteri selezione">
											<f:selectItem id="critVisualizzaSoggetti" itemLabel="Soggetto" itemValue="soggetti"/>
											<f:selectItem id="critVisualizzaServizi" itemLabel="Servizio" itemValue="servizi"/>
											<a4j:support event="onclick" reRender="soggettiServiziAssociatiCtr" actionListener="#{utentiBean.criteriSelectListener}" />
										</h:selectManyCheckbox>
									</link:prop>
									
									<a4j:outputPanel rendered="#{utentiBean.showSoggettiAssociati}" layout="block" id="pickSoggServAssociati_pckListCtr">
										<a4j:queue requestDelay="500" ignoreDupResponses="false" oncomplete="saveList();" id="codaFiltriSoggetti" name="codaFiltriSoggetti"/>
										<a4j:jsFunction name="saveList" execute="input_pckLst_pickSoggServAssociati" />
										<a4j:outputPanel rendered="#{utentiBean.visualizzaFiltroSoggetto}" layout="block" id="filtroSoggettoCtr">
											<div class="prop">
												<label class="">
													<h:outputText value="Filtra Soggetti" />
												</label>
												<h:inputText id="input_pickSoggServAssociatiSourceSoggFilter" value="#{utentiBean.soggettoSuggestionValue}" style="#{utentiBean.suggestionBoxStyle}" styleClass="inputLink">
															<a4j:support status="mainStatus" event="onkeyup"  actionListener="#{utentiBean.filtroSoggettiSelectListener}" ajaxSingle="true"
																eventsQueue="codaFiltriSoggetti"
															reRender="input_pckLst_pickSoggServAssociati"  />
												</h:inputText>
											</div>
											<rich:spacer width="1" height="5" />
										</a4j:outputPanel>
										<a4j:outputPanel rendered="#{utentiBean.visualizzaFiltroServizio}" layout="block" id="filtroServizioCtr">
											<div class="prop">
												<label class="">
													<h:outputText value="Filtra Servizi" />
												</label>
												<h:inputText id="input_pickSoggServAssociatiSourceServFilter" value="#{utentiBean.servizioSuggestionValue}" style="#{utentiBean.suggestionBoxStyle}" styleClass="inputLink">
															<a4j:support status="mainStatus" event="onkeyup" eventsQueue="codaFiltriSoggetti" actionListener="#{utentiBean.filtroServiziSelectListener}"  ajaxSingle="true"
															reRender="input_pckLst_pickSoggServAssociati"  />
												</h:inputText>
											</div>
											<rich:spacer width="1" height="5"  />
										</a4j:outputPanel>
								    	<div class="prop">
											<label class="">
												<h:outputText value="&#160;" />
											</label>
											<rich:listShuttle id="input_pckLst_pickSoggServAssociati"
													sourceValue="#{utentiBean.soggettiServizi}"
													targetValue="#{utentiBean.tipiNomiSoggettiServiziSelezionati}" var="selectItem" listsHeight="190"
													sourceListWidth="#{utentiBean.soggettiServiziSourceListWidth}"
													targetListWidth="#{utentiBean.soggettiServiziTargetListWidth}" label="Soggetti e Servizi associati"
													copyAllControlLabel="Copia tutti" copyControlLabel="Copia"
													removeAllControlLabel="Rimuovi tutti" removeControlLabel="Rimuovi"
													downControlLabel="Sotto" bottomControlLabel="Ultimo" topControlLabel="Primo" upControlLabel="Sopra"
													converter="multipleChoiceItemConverter"		>
													<rich:column>
														<h:outputText value="#{selectItem.label}"></h:outputText>
													</rich:column>
													<a4j:support event="onlistchange" ajaxSingle="true" actionListener="#{utentiBean.soggettiServiziSelectListener}" oncomplete="saveList()"/>
													<f:selectItems value="#{utentiBean.immagineSoggetti}" />
													
												    <f:facet name="topControl">
												   		<a4j:outputPanel styleClass="rich-list-shuttle-button" layout="block" onmouseover="this.className='rich-list-shuttle-button-light'" 
											        			onmousedown="this.className='rich-list-shuttle-button-press'" 
											        			onmouseup="this.className='rich-list-shuttle-button'" 
											        			onmouseout="this.className='rich-list-shuttle-button'">
											        			<a4j:outputPanel styleClass="rich-list-shuttle-button-content" layout="block">
											        				<h:graphicImage value="/images/tema_link/move_top.png"/>
											        			</a4j:outputPanel>
											        	</a4j:outputPanel>
											        </f:facet>
											        
											        <f:facet name="topControlDisabled">
											        	<a4j:outputPanel styleClass="rich-list-shuttle-button-disabled" layout="block">
											        		<a4j:outputPanel styleClass="rich-list-shuttle-button-content" layout="block">
											        			 <h:graphicImage value="/images/tema_link/move_top_disabilitato.png"/>
											        		</a4j:outputPanel>
											        	</a4j:outputPanel>
											        </f:facet>
											        
											        <f:facet name="bottomControl">
											    	    <a4j:outputPanel styleClass="rich-list-shuttle-button" layout="block" onmouseover="this.className='rich-list-shuttle-button-light'" 
											        			onmousedown="this.className='rich-list-shuttle-button-press'" 
											        			onmouseup="this.className='rich-list-shuttle-button'" 
											        			onmouseout="this.className='rich-list-shuttle-button'">
											        			<a4j:outputPanel styleClass="rich-list-shuttle-button-content" layout="block">
											        				<h:graphicImage value="/images/tema_link/move_bottom.png"/>
											        			</a4j:outputPanel>
											        	 </a4j:outputPanel>
											        </f:facet>
											        
											        <f:facet name="bottomControlDisabled">
											       		<a4j:outputPanel styleClass="rich-list-shuttle-button-disabled" layout="block">
											        		<a4j:outputPanel styleClass="rich-list-shuttle-button-content" layout="block">
											        			<h:graphicImage value="/images/tema_link/move_bottom_disabilitato.png"/>
											        		</a4j:outputPanel>
											        	</a4j:outputPanel>
											        </f:facet>
											        
											        <f:facet name="upControl">
											       		 <a4j:outputPanel styleClass="rich-list-shuttle-button" layout="block" onmouseover="this.className='rich-list-shuttle-button-light'" 
											        			onmousedown="this.className='rich-list-shuttle-button-press'" 
											        			onmouseup="this.className='rich-list-shuttle-button'" 
											        			onmouseout="this.className='rich-list-shuttle-button'">
											        			<a4j:outputPanel styleClass="rich-list-shuttle-button-content" layout="block">
											        				<h:graphicImage value="/images/tema_link/move_up.png"/>
											        			</a4j:outputPanel>
											        	 </a4j:outputPanel>
											        </f:facet>
											        
											        <f:facet name="upControlDisabled">
											        <a4j:outputPanel styleClass="rich-list-shuttle-button-disabled" layout="block">
											        		<a4j:outputPanel styleClass="rich-list-shuttle-button-content" layout="block">
											        			<h:graphicImage value="/images/tema_link/move_up_disabilitato.png"/>
											        		</a4j:outputPanel>
											        	</a4j:outputPanel>
											        </f:facet>
											        
											        <f:facet name="downControl">
											     	   <a4j:outputPanel styleClass="rich-list-shuttle-button" layout="block" onmouseover="this.className='rich-list-shuttle-button-light'" 
											        			onmousedown="this.className='rich-list-shuttle-button-press'" 
											        			onmouseup="this.className='rich-list-shuttle-button'" 
											        			onmouseout="this.className='rich-list-shuttle-button'">
											        			<a4j:outputPanel styleClass="rich-list-shuttle-button-content" layout="block">
											        				<h:graphicImage value="/images/tema_link/move_down.png"/>
											        			</a4j:outputPanel>
											        	 </a4j:outputPanel>
											        </f:facet>
											        
											        <f:facet name="downControlDisabled">
											        <a4j:outputPanel styleClass="rich-list-shuttle-button-disabled" layout="block">
											        		<a4j:outputPanel styleClass="rich-list-shuttle-button-content" layout="block">
											        			 <h:graphicImage value="/images/tema_link/move_down_disabilitato.png"/>
											        		</a4j:outputPanel>
											        	</a4j:outputPanel>
											        </f:facet>
											        
											        <f:facet name="copyControl">
											        	<a4j:outputPanel styleClass="rich-list-shuttle-button" layout="block" onmouseover="this.className='rich-list-shuttle-button-light'" 
											        			onmousedown="this.className='rich-list-shuttle-button-press'" 
											        			onmouseup="this.className='rich-list-shuttle-button'" 
											        			onmouseout="this.className='rich-list-shuttle-button'">
											        			<a4j:outputPanel styleClass="rich-list-shuttle-button-content" layout="block">
											        				<h:graphicImage value="/images/tema_link/go_next.png"/>
											        			</a4j:outputPanel>
											        	 </a4j:outputPanel>
											        </f:facet>
											        
											        <f:facet name="copyControlDisabled">
											        <a4j:outputPanel styleClass="rich-list-shuttle-button-disabled" layout="block">
											        		<a4j:outputPanel styleClass="rich-list-shuttle-button-content" layout="block">
											        			<h:graphicImage value="/images/tema_link/go_next_disabilitato.png"/>
											        		</a4j:outputPanel>
											        	</a4j:outputPanel>
											        </f:facet>
											        
											        <f:facet name="copyAllControl">
											        		<a4j:outputPanel styleClass="rich-list-shuttle-button" layout="block" onmouseover="this.className='rich-list-shuttle-button-light'" 
											        			onmousedown="this.className='rich-list-shuttle-button-press'" 
											        			onmouseup="this.className='rich-list-shuttle-button'" 
											        			onmouseout="this.className='rich-list-shuttle-button'">
											        			<a4j:outputPanel styleClass="rich-list-shuttle-button-content" layout="block">
											        				 <h:graphicImage value="/images/tema_link/go_end.png"/>
											        			</a4j:outputPanel>
											        	 </a4j:outputPanel>
											        </f:facet>
											        
											        <f:facet name="copyAllControlDisabled">
											        <a4j:outputPanel styleClass="rich-list-shuttle-button-disabled" layout="block">
											        		<a4j:outputPanel styleClass="rich-list-shuttle-button-content" layout="block">
											        			<h:graphicImage value="/images/tema_link/go_end_disabilitato.png"/>
											        		</a4j:outputPanel>
											        	</a4j:outputPanel>
											        </f:facet>
											        
											        <f:facet name="removeControl">
											        	<a4j:outputPanel styleClass="rich-list-shuttle-button" layout="block" onmouseover="this.className='rich-list-shuttle-button-light'" 
											        			onmousedown="this.className='rich-list-shuttle-button-press'" 
											        			onmouseup="this.className='rich-list-shuttle-button'" 
											        			onmouseout="this.className='rich-list-shuttle-button'">
											        			<a4j:outputPanel styleClass="rich-list-shuttle-button-content" layout="block">
											        				<h:graphicImage value="/images/tema_link/go_prev.png"/>
											        			</a4j:outputPanel>
											        	 </a4j:outputPanel>
											        </f:facet>
											        
											        <f:facet name="removeControlDisabled">
											        <a4j:outputPanel styleClass="rich-list-shuttle-button-disabled" layout="block">
											        		<a4j:outputPanel styleClass="rich-list-shuttle-button-content" layout="block">
											        			<h:graphicImage value="/images/tema_link/go_prev_disabilitato.png"/>
											        		</a4j:outputPanel>
											        	</a4j:outputPanel>
											        </f:facet>
											        
											        <f:facet name="removeAllControl">
											        	<a4j:outputPanel layout="block" styleClass="rich-list-shuttle-button" onmouseover="this.className='rich-list-shuttle-button-light'" 
											        			onmousedown="this.className='rich-list-shuttle-button-press'" 
											        			onmouseup="this.className='rich-list-shuttle-button'" 
											        			onmouseout="this.className='rich-list-shuttle-button'">
											        			<a4j:outputPanel layout="block" styleClass="rich-list-shuttle-button-content">
											        				<h:graphicImage value="/images/tema_link/go_start.png"/>
											        			</a4j:outputPanel>
											        	 </a4j:outputPanel>
											        </f:facet>
											        
											        <f:facet name="removeAllControlDisabled">
											        	<a4j:outputPanel styleClass="rich-list-shuttle-button-disabled" layout="block">
											        		<a4j:outputPanel styleClass="rich-list-shuttle-button-content" layout="block">
											        			<h:graphicImage value="/images/tema_link/go_start_disabilitato.png"/>
											        		</a4j:outputPanel>
											        	</a4j:outputPanel>
											        </f:facet>
											        
											</rich:listShuttle>
											<p class="note">
												<h:outputText value="Seleziona i soggetti e/o i servizi dalla lista di sinistra" />
											</p>
										</div>
								    </a4j:outputPanel>
								</link:fieldset>
							</a4j:outputPanel>
							
								<div class="buttonrow">
									<h:commandButton id="creaUtente" value="Crea Utente" styleClass="icon-save" action="#{utentiBean.salva}" rendered="#{empty utentiBean.user.id or (not empty utentiBean.user.id and utentiBean.user.id lt 1)}"/>
									<h:commandButton id="modificaUtenteBtn" styleClass="icon-save" value="Aggiorna Utente" action="#{utentiBean.salva}" rendered="#{not empty utentiBean.user.id and utentiBean.user.id gt 0}">
									</h:commandButton>
								</div>
						</h:form>
					
					<rich:spacer id="spacer1" height="10px"/>
				</c:if>
				<c:if test="#{applicationBean.user and applicationBean.showCambiaPassword}">
					<c:if test="#{applicationBean.operatore and !applicationBean.amministratore}">
						<link:fieldset legend="Soggetti Associati" rendered="#{not empty utentiBean.listaSoggettiAssociatiUtente}" collapsible="false" closed="false">	
							<h:panelGrid columns="1" styleClass="borderSpacingTable" columnClasses="valueAllineataSx">
								<c:forEach items="#{utentiBean.listaSoggettiAssociatiUtente}" var="sog">
									<h:outputText styleClass="" value="#{sog}" />
								</c:forEach>
							</h:panelGrid>
						</link:fieldset>
						<a4j:outputPanel layout="block" rendered="#{not empty utentiBean.listaSoggettiAssociatiUtente}">	
							<div class="spacerDettaglio"></div>
						</a4j:outputPanel>
						
						<link:fieldset legend="Servizi Associati" rendered="#{not empty utentiBean.listaServiziAssociatiUtente}" collapsible="false" closed="false">
							<h:panelGrid columns="1" styleClass="borderSpacingTable" columnClasses="valueAllineataSx">	
								<c:forEach items="#{utentiBean.listaServiziAssociatiUtente}" var="ser">
									<h:outputText styleClass="" value="#{ser}" />
								</c:forEach>
							</h:panelGrid>
						</link:fieldset>
						<a4j:outputPanel layout="block" rendered="#{not empty utentiBean.listaServiziAssociatiUtente}">	
							<div class="spacerDettaglio"></div>
						</a4j:outputPanel>
					</c:if>
					
					<a4j:outputPanel layout="block" id="panelRoleUser" rendered="#{not empty utentiBean.user.id and utentiBean.user.id gt 0}">
						<h:form id="formRoleUser" prependId="false">
							<h:inputHidden id="inUser" value="#{utentiBean.user.id}"/>
							<link:fieldset legend="Password" rendered="#{not empty utentiBean.user.id and utentiBean.user.id gt 0}" collapsible="false" closed="false">
								<link:prop label="Modifica">
									<h:selectBooleanCheckbox id="_modificaPwd" styleClass="controlset" value="#{utentiBean.showFormCambiaPassword}" >
										<a4j:support status="mainStatus" event="onchange" reRender="panelRoleUser" />
										</h:selectBooleanCheckbox>
								</link:prop>
								
								<a4j:outputPanel layout="block" rendered="#{utentiBean.showFormCambiaPassword}" id="fieldFormPwdPanel">	
									<link:prop label="Vecchia" required="true" rendered="#{utentiBean.showVecchiaPassword}">
										<h:inputSecret label="Vecchia" id="_oldPwdChange" value="#{utentiBean.vecchiaPassword}"  styleClass="inputLinkLong"/>
									</link:prop>
								
									<link:prop label="Nuova" required="true">
										<h:inputSecret label="Nuova" id="_pwdChange" value="#{utentiBean.user.password}"   styleClass="inputLinkLong"/>
									</link:prop>
										
									<link:prop label="Conferma Nuova" required="true" note="#{utentiBean.notePassword}" noteEscape="false">
										<h:inputSecret id="conpwdChange" label="Conferma Nuova" value="#{utentiBean.confermaPassword}"   styleClass="inputLinkLong"/>
									</link:prop>
								</a4j:outputPanel>
							</link:fieldset>
							<a4j:outputPanel layout="block" styleClass="buttonrow"  rendered="#{utentiBean.showFormCambiaPassword}" id="buttonFormPwdPanel">
								<a4j:commandButton id="modificaPwd" styleClass="icon-save" action="#{utentiBean.cambioPassword}" value="Modifica Password" reRender="panelRoleUser"/>
							</a4j:outputPanel>
						</h:form>
					</a4j:outputPanel>
				</c:if>
		</ui:define>
</ui:composition>
