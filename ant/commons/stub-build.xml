<project name="openspcoop2-stub">
    <description>
        Produzione Stub di un WebServices
    </description>
	
	<!-- estensione di ant (if .... ) -->
	<taskdef resource="net/sf/antcontrib/antcontrib.properties">
          <classpath>
              <pathelement location="${required_lib}/ant/ant-contrib-1.0b3.jar"/>
          </classpath>
	</taskdef>
	
	<!-- Check JAVA VERSIONE -->
	<!-- <import file="java-check.xml" /> -->
	<!-- NOTA: se uso import java-check va in out of memory -->
	<property environment="env"/>
	<var name="java_home" value="${env.JAVA_HOME}"/>
	<echo message="Java home: ${java_home}"/>
	<!-- <echo message="Java version: ${ant.java.version}"/> L'informazione viene errata, stampa 1.6 anche per java 1.7-->
	<if>
		<equals arg1="${java_home}" arg2="$${env.JAVA_HOME}"/>
		<then>
			<fail message="JAVA_HOME non impostata"/>
		</then>
	</if>
	<if>
		<or>
			<equals arg1="${ant.java.version}" arg2="1.3" />
			<equals arg1="${ant.java.version}" arg2="1.4" />
	     	<equals arg1="${ant.java.version}" arg2="1.5" />
		</or>
		<then>
			<fail message="OpenSPCoop2 richiede java 6 o superiore"/>
		</then>
	</if>

	
	<!-- compilazione degli stub per AXIS14-->
	<target name="build_axis14">
		
		<!-- Generazioni java classes -->
		<if>
			<not>
				<equals arg1="${stubPackageOverriding}" arg2="$${stubPackageOverriding}"/>
			</not>
			<then>
				<java classname="org.apache.axis.wsdl.WSDL2Java" fork="true">
					<arg value="-o" />
					<arg value="${stubBuild.srcDir}" />
					<arg value="-p" />
					<arg value="${stubPackageOverriding}" />
					<arg value="${stubBuild.urlWSDL}" />
					<classpath>
						<pathelement path="${required_lib}/axis14/axis-1.4.jar"/>
						<pathelement path="${required_lib}/axis14/axis-jaxrpc-1.4.jar"/>
						<pathelement path="${required_lib}/axis14/axis-saaj-1.4.jar"/>
						<pathelement path="${required_lib}/commons/commons-discovery-0.5.jar"/>
						<pathelement path="${required_lib}/commons/commons-logging-1.1.1.jar"/>
						<pathelement path="${required_lib}/shared/wsdl4j-1.6.2.jar"/>
						<pathelement path="${required_lib}/shared/activation-1.1.1.jar"/>
						<pathelement path="${required_lib}/shared/mailapi-1.4.4.jar"/>
					</classpath>
				</java>
			</then>
			<else>
				<java classname="org.apache.axis.wsdl.WSDL2Java" fork="true">
					<arg value="-o" />
					<arg value="${stubBuild.srcDir}" />
					<arg value="${stubBuild.urlWSDL}" />
					<classpath>
						<pathelement path="${required_lib}/axis14/axis-1.4.jar"/>
						<pathelement path="${required_lib}/axis14/axis-jaxrpc-1.4.jar"/>
						<pathelement path="${required_lib}/axis14/axis-saaj-1.4.jar"/>
						<pathelement path="${required_lib}/commons/commons-discovery-0.5.jar"/>
						<pathelement path="${required_lib}/commons/commons-logging-1.1.1.jar"/>
						<pathelement path="${required_lib}/shared/wsdl4j-1.6.2.jar"/>
						<pathelement path="${required_lib}/shared/activation-1.1.1.jar"/>
						<pathelement path="${required_lib}/shared/mailapi-1.4.4.jar"/>
					</classpath>
				</java>	
			</else>
		</if>
		
		<!-- Compilazione classi -->
		<javac destdir="${stubBuild.buildDir}" debug="${debug}">
			<src path="${stubBuild.srcDir}" />
			<classpath>
				<pathelement path="${required_lib}/axis14/axis-1.4.jar"/>
				<pathelement path="${required_lib}/axis14/axis-jaxrpc-1.4.jar"/>
				<pathelement path="${required_lib}/axis14/axis-saaj-1.4.jar"/>
				<pathelement path="${required_lib}/commons/commons-discovery-0.5.jar"/>
				<pathelement path="${required_lib}/commons/commons-logging-1.1.1.jar"/>
				<pathelement path="${required_lib}/shared/wsdl4j-1.6.2.jar"/>
				<pathelement path="${required_lib}/shared/activation-1.1.1.jar"/>
				<pathelement path="${required_lib}/shared/mailapi-1.4.4.jar"/>
			</classpath>
		</javac>
		
		<!-- Rimozione sorgenti-->
		<if>
			<istrue value="${stubBuild.cleanSrcDir}" />
			<then>
				<delete dir="${stubBuild.srcDir}" />
			</then>
		</if>

		<!-- jar -->
		<if>
			<istrue value="${stubBuild.buildJar}" />
			<then>
				<jar jarfile="${stubBuild.jar}">
					<zipfileset dir="${stubBuild.buildDir}" />
				</jar>
			</then>
		</if>
			
	</target>
	
	
	
	
	
	
	<!-- compilazione degli stub per CXF-->
	<target name="build_cxf">
		
		<!-- Generazioni java classes -->
		<if>
			<not>
				<equals arg1="${stubPackageOverriding}" arg2="$${stubPackageOverriding}"/>
			</not>
			<then>
				<java classname="org.apache.cxf.tools.wsdlto.WSDLToJava" fork="true">
					<arg value="-d" />
					<arg value="${stubBuild.srcDir}" />
					<arg value="-p" />
					<arg value="${stubPackageOverriding}" />
					<arg value="${stubBuild.urlWSDL}" />
					<classpath>
						<fileset dir="${required_lib}/cxf" includes="*.jar"/>
						<fileset dir="${required_lib}/jax" includes="jaxb*.jar"/>
						<fileset dir="${required_lib}/shared" includes="activation-1.1.1.jar"/>
						<fileset dir="${required_lib}/shared" includes="velocity-1.6.4.jar"/>
						<fileset dir="${required_lib}/shared" includes="wsdl4j-1.6.2.jar"/>
						<fileset dir="${required_lib}/security" includes="neethi-3.0.2.jar"/>
						<fileset dir="${required_lib}/commons" includes="*.jar"/>
					</classpath>
				</java>	
			</then>
			<else>
				<java classname="org.apache.cxf.tools.wsdlto.WSDLToJava" fork="true">
					<arg value="-d" />
					<arg value="${stubBuild.srcDir}" />
					<arg value="${stubBuild.urlWSDL}" />
					<classpath>
						<fileset dir="${required_lib}/cxf" includes="*.jar"/>
						<fileset dir="${required_lib}/jax" includes="jaxb*.jar"/>
						<fileset dir="${required_lib}/shared" includes="activation-1.1.1.jar"/>
						<fileset dir="${required_lib}/shared" includes="velocity-1.6.4.jar"/>
						<fileset dir="${required_lib}/shared" includes="wsdl4j-1.6.2.jar"/>
						<fileset dir="${required_lib}/security" includes="neethi-3.0.2.jar"/>
						<fileset dir="${required_lib}/commons" includes="*.jar"/>
					</classpath>
				</java>	
			</else>
		</if>
		
		<!-- Compilazione classi -->
		<javac destdir="${stubBuild.buildDir}" debug="${debug}">
			<src path="${stubBuild.srcDir}" />
			<classpath>
				<fileset dir="${required_lib}/cxf" includes="*.jar"/>
				<fileset dir="${required_lib}/jax" includes="jaxb*.jar"/>
				<fileset dir="${required_lib}/shared" includes="activation-1.1.1.jar"/>
				<fileset dir="${required_lib}/shared" includes="velocity-1.6.4.jar"/>
				<fileset dir="${required_lib}/shared" includes="wsdl4j-1.6.2.jar"/>
				<fileset dir="${required_lib}/security" includes="neethi-3.0.2.jar"/>
				<fileset dir="${required_lib}/commons" includes="*.jar"/>
			</classpath>
		</javac>

		<!-- Rimozione sorgenti-->
		<if>
			<istrue value="${stubBuild.cleanSrcDir}" />
			<then>
				<delete dir="${stubBuild.srcDir}" />
			</then>
		</if>

		<!-- jar -->
		<if>
			<istrue value="${stubBuild.buildJar}" />
			<then>
				<jar jarfile="${stubBuild.jar}">
					<zipfileset dir="${stubBuild.buildDir}" />
				</jar>
			</then>
		</if>
			
	</target>
	
	
	
	
</project>
