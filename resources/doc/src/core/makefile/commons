html:	convert-accents
	@echo "Producing html files ..."
	xmlto html-nochunks -x ../core/xsl/main-html-nochunks.xsl ${SOURCE_FILE}.converted --skip-validation
	@echo "Producing html files ok"

xhtml:
	xmlto xhtml -x ../core/xsl/main-xhtml-chunks.xsl ${SOURCE_FILE}.converted -o xhtmlout --skip-validation

pdf:    convert-accents
	@echo "Producing pdf ..."
	dblatex ${DB_LATEX_OPTIONS} --pdf ${SOURCE_FILE}.converted -o ${SOURCE_NAME}${PDF_DOC_VERSION}_originalCover.pdf
	gs -dBATCH -dNOPAUSE -q -sDEVICE=pdfwrite -sOutputFile=${SOURCE_NAME}${PDF_DOC_VERSION}_originalCover_noPagineIniziali.pdf -dFirstPage=2 ${SOURCE_NAME}${PDF_DOC_VERSION}_originalCover.pdf
	gs -dBATCH -dNOPAUSE -q -sDEVICE=pdfwrite -sOutputFile=GovWay-${SOURCE_NAME}.pdf cover/cover.pdf ${SOURCE_NAME}${PDF_DOC_VERSION}_originalCover_noPagineIniziali.pdf
	@echo "Producing pdf ok"

img:
	@echo "Producing img ..."
	@mkdir -p FIGURE_OUT
	@for file in figure/*.jpg; do \
		( convert $$file FIGURE_OUT/`basename $$file jpg`pdf; convert $$file FIGURE_OUT/`basename $$file`) \
	done
	@for file in figure/*.png; do \
                ( convert $$file FIGURE_OUT/`basename $$file png`pdf; convert $$file FIGURE_OUT/`basename $$file`) \
        done
	@echo "Producing img ok"

clean: clean-html clean-pdf clean-xhtml
	rm -f ${SOURCE_FILE}~ 
	rm -f ${SOURCE_FILE}.converted
	rm -rf FIGURE_OUT

clean-html:
	rm -f *.html

clean-xhtml:
	rm -rf xhtmlout

clean-pdf:
	rm -f *${SOURCE_NAME}*.pdf 

convert-accents:
	cp ${SOURCE_FILE} ${SOURCE_FILE}.converted
	perl -pi -e "s/à/&agrave;/g" ${SOURCE_FILE}.converted
	perl -pi -e "s/è/&egrave;/g" ${SOURCE_FILE}.converted
	perl -pi -e "s/È/&Egrave;/g" ${SOURCE_FILE}.converted
	perl -pi -e "s/È/&Egrave;/g" ${SOURCE_FILE}.converted
	perl -pi -e "s/ì/&igrave;/g" ${SOURCE_FILE}.converted
	perl -pi -e "s/Ì/&Igrave;/g" ${SOURCE_FILE}.converted
	perl -pi -e "s/ù/&ugrave;/g" ${SOURCE_FILE}.converted
	perl -pi -e "s/Ù/&Ugrave;/g" ${SOURCE_FILE}.converted
	perl -pi -e "s/Ò/&Ograve;/g" ${SOURCE_FILE}.converted
	perl -pi -e "s/é/&eacute;/g" ${SOURCE_FILE}.converted
	perl -pi -e "s/É/&Eacute;/g" ${SOURCE_FILE}.converted


